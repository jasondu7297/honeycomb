import re
import collections
def parse_state_snapshot(snapshot_str, messages, checkpoints):
    """
    Given a snapshot string (one StateSnapshot), extract:
      - most_recent_message: the content of the last message in values['messages']
      - checkpoint_id: from the config configurable section
      - thread_id: from the config configurable section
    """

    
    # 1. Extract the messages from the "values" dictionary.
    #    We look for the pattern: values={'messages': [ ... ]}

    msg_contents = collections.OrderedDict.fromkeys(re.findall(r"content='([^']+)'", snapshot_str))
    checkpoint_id = re.search(r"'checkpoint_id': '([^']+)'", snapshot_str)
    if checkpoint_id:
        checkpoints[checkpoint_id.group(1)] = True
    messages.update(msg_contents)
    checkpoints.update(checkpoints)
    print(messages)
    print("message count")
    print(len(messages))
    print("----")
    print("checkpoint count")
    print(len(checkpoints))
    print(checkpoints)
   

def parse_all_snapshots(input_str):
    """
    Given the full input string containing one or more StateSnapshot objects,
    split them apart and parse each one.
    """
    snapshots = []
    messages = collections.OrderedDict()
    checkpoints = collections.OrderedDict()
    # Use a lookahead to split the string on each occurrence of "StateSnapshot("
    parts = re.split(r"(?=StateSnapshot\()", input_str)
    for part in parts[::-1]:
        part = part.strip()
        if part.startswith("StateSnapshot("):
            # print(part)
            parse_state_snapshot(part, messages, checkpoints)

    for msg, checkpoint in zip(messages, checkpoints):
        result = {
            'most_recent_message': None,
            'checkpoint_id': None,
            'thread_id': None
        }
        result['most_recent_message'] = msg
        result['checkpoint_id'] = checkpoint
        thread_id = re.search(r"'thread_id': '([^']+)'", input_str)
        if thread_id:
            result['thread_id'] = thread_id.group(1)
        print(result)
        print("___________")
        snapshots.append(result)
    
    return snapshots

# Example input (as a string):
input_string = """
[StateSnapshot(values={'messages': [HumanMessage(content='Who was the 10th US president?', additional_kwargs={}, response_metadata={}, id='b1a585f0-866d-42f2-9216-a8693e94ea84'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'function': {'arguments': '{}', 'name': 'transfer_to_gsearchagent'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 14, 'prompt_tokens': 1011, 'total_tokens': 1025, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_523b9b6e5f', 'finish_reason': 'tool_calls', 'logprobs': None}, name='supervisor', id='run-0b75c81a-cad3-424f-afd1-a407860c62f1-0', tool_calls=[{'name': 'transfer_to_gsearchagent', 'args': {}, 'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1011, 'output_tokens': 14, 'total_tokens': 1025, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), ToolMessage(content='Successfully transferred to GSearchAgent', name='transfer_to_gsearchagent', id='444b7002-2f15-4c02-89a2-93ece54df238', tool_call_id='call_YMbF7OkWWH2AFQb5VedTKBY7'), AIMessage(content='The 10th President of the United States was John Tyler. He served from 1841 to 1845.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 96, 'total_tokens': 122, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_ff092ab25e', 'finish_reason': 'stop', 'logprobs': None}, name='GSearchAgent', id='run-643d10b3-2a23-4c6e-9d63-751e62685f53-0', usage_metadata={'input_tokens': 96, 'output_tokens': 26, 'total_tokens': 122, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), AIMessage(content='Transferring back to supervisor', additional_kwargs={}, response_metadata={}, name='GSearchAgent', id='2e842837-2dfb-42a4-a968-a1cab66533df', tool_calls=[{'name': 'transfer_back_to_supervisor', 'args': {}, 'id': 'a1780a61-b190-4b29-8b7b-ea7b4ec494c1', 'type': 'tool_call'}]), ToolMessage(content='Successfully transferred back to supervisor', name='transfer_back_to_supervisor', id='2ecaee32-8cfd-460f-9a12-74d069214010', tool_call_id='a1780a61-b190-4b29-8b7b-ea7b4ec494c1'), AIMessage(content='The 10th President of the United States was John Tyler, who served from 1841 to 1845.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 1120, 'total_tokens': 1146, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_523b9b6e5f', 'finish_reason': 'stop', 'logprobs': None}, name='supervisor', id='run-43497ffa-1c02-41e1-a8a7-6972bef70e35-0', usage_metadata={'input_tokens': 1120, 'output_tokens': 26, 'total_tokens': 1146, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}, next=(), config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1efec06f-9830-6b34-8003-44c253a3e2aa'}}, metadata={'source': 'loop', 'writes': {'supervisor': {'messages': [HumanMessage(content='Who was the 10th US president?', additional_kwargs={}, response_metadata={}, id='b1a585f0-866d-42f2-9216-a8693e94ea84'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'function': {'arguments': '{}', 'name': 'transfer_to_gsearchagent'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 14, 'prompt_tokens': 1011, 'total_tokens': 1025, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_523b9b6e5f', 'finish_reason': 'tool_calls', 'logprobs': None}, name='supervisor', id='run-0b75c81a-cad3-424f-afd1-a407860c62f1-0', tool_calls=[{'name': 'transfer_to_gsearchagent', 'args': {}, 'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1011, 'output_tokens': 14, 'total_tokens': 1025, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), ToolMessage(content='Successfully transferred to GSearchAgent', name='transfer_to_gsearchagent', id='444b7002-2f15-4c02-89a2-93ece54df238', tool_call_id='call_YMbF7OkWWH2AFQb5VedTKBY7'), AIMessage(content='The 10th President of the United States was John Tyler. He served from 1841 to 1845.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 96, 'total_tokens': 122, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_ff092ab25e', 'finish_reason': 'stop', 'logprobs': None}, name='GSearchAgent', id='run-643d10b3-2a23-4c6e-9d63-751e62685f53-0', usage_metadata={'input_tokens': 96, 'output_tokens': 26, 'total_tokens': 122, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), AIMessage(content='Transferring back to supervisor', additional_kwargs={}, response_metadata={}, name='GSearchAgent', id='2e842837-2dfb-42a4-a968-a1cab66533df', tool_calls=[{'name': 'transfer_back_to_supervisor', 'args': {}, 'id': 'a1780a61-b190-4b29-8b7b-ea7b4ec494c1', 'type': 'tool_call'}]), ToolMessage(content='Successfully transferred back to supervisor', name='transfer_back_to_supervisor', id='2ecaee32-8cfd-460f-9a12-74d069214010', tool_call_id='a1780a61-b190-4b29-8b7b-ea7b4ec494c1'), AIMessage(content='The 10th President of the United States was John Tyler, who served from 1841 to 1845.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 1120, 'total_tokens': 1146, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_523b9b6e5f', 'finish_reason': 'stop', 'logprobs': None}, name='supervisor', id='run-43497ffa-1c02-41e1-a8a7-6972bef70e35-0', usage_metadata={'input_tokens': 1120, 'output_tokens': 26, 'total_tokens': 1146, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}}, 'thread_id': '1', 'step': 3, 'parents': {}}, created_at='2025-02-16T01:40:17.184828+00:00', parent_config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1efec06f-8f11-6012-8002-fd03f63f4d10'}}, tasks=()),
 StateSnapshot(values={'messages': [HumanMessage(content='Who was the 10th US president?', additional_kwargs={}, response_metadata={}, id='b1a585f0-866d-42f2-9216-a8693e94ea84'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'function': {'arguments': '{}', 'name': 'transfer_to_gsearchagent'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 14, 'prompt_tokens': 1011, 'total_tokens': 1025, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_523b9b6e5f', 'finish_reason': 'tool_calls', 'logprobs': None}, name='supervisor', id='run-0b75c81a-cad3-424f-afd1-a407860c62f1-0', tool_calls=[{'name': 'transfer_to_gsearchagent', 'args': {}, 'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1011, 'output_tokens': 14, 'total_tokens': 1025, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), ToolMessage(content='Successfully transferred to GSearchAgent', name='transfer_to_gsearchagent', id='444b7002-2f15-4c02-89a2-93ece54df238', tool_call_id='call_YMbF7OkWWH2AFQb5VedTKBY7'), AIMessage(content='The 10th President of the United States was John Tyler. He served from 1841 to 1845.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 96, 'total_tokens': 122, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_ff092ab25e', 'finish_reason': 'stop', 'logprobs': None}, name='GSearchAgent', id='run-643d10b3-2a23-4c6e-9d63-751e62685f53-0', usage_metadata={'input_tokens': 96, 'output_tokens': 26, 'total_tokens': 122, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), AIMessage(content='Transferring back to supervisor', additional_kwargs={}, response_metadata={}, name='GSearchAgent', id='2e842837-2dfb-42a4-a968-a1cab66533df', tool_calls=[{'name': 'transfer_back_to_supervisor', 'args': {}, 'id': 'a1780a61-b190-4b29-8b7b-ea7b4ec494c1', 'type': 'tool_call'}]), ToolMessage(content='Successfully transferred back to supervisor', name='transfer_back_to_supervisor', id='2ecaee32-8cfd-460f-9a12-74d069214010', tool_call_id='a1780a61-b190-4b29-8b7b-ea7b4ec494c1')]}, next=('supervisor',), config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1efec06f-8f11-6012-8002-fd03f63f4d10'}}, metadata={'source': 'loop', 'writes': {'GSearchAgent': {'messages': [AIMessage(content='The 10th President of the United States was John Tyler. He served from 1841 to 1845.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 96, 'total_tokens': 122, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_ff092ab25e', 'finish_reason': 'stop', 'logprobs': None}, name='GSearchAgent', id='run-643d10b3-2a23-4c6e-9d63-751e62685f53-0', usage_metadata={'input_tokens': 96, 'output_tokens': 26, 'total_tokens': 122, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), AIMessage(content='Transferring back to supervisor', additional_kwargs={}, response_metadata={}, name='GSearchAgent', id='2e842837-2dfb-42a4-a968-a1cab66533df', tool_calls=[{'name': 'transfer_back_to_supervisor', 'args': {}, 'id': 'a1780a61-b190-4b29-8b7b-ea7b4ec494c1', 'type': 'tool_call'}]), ToolMessage(content='Successfully transferred back to supervisor', name='transfer_back_to_supervisor', id='2ecaee32-8cfd-460f-9a12-74d069214010', tool_call_id='a1780a61-b190-4b29-8b7b-ea7b4ec494c1')]}}, 'thread_id': '1', 'step': 2, 'parents': {}}, created_at='2025-02-16T01:40:16.228126+00:00', parent_config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1efec06f-88a7-633e-8001-375fa4b6d39d'}}, tasks=(PregelTask(id='03d63591-154e-98b9-1c00-b6beb97d7e19', name='supervisor', path=('__pregel_pull', 'supervisor'), error=None, interrupts=(), state={'configurable': {'thread_id': '1', 'checkpoint_ns': 'supervisor:03d63591-154e-98b9-1c00-b6beb97d7e19'}}, result={'messages': [HumanMessage(content='Who was the 10th US president?', additional_kwargs={}, response_metadata={}, id='b1a585f0-866d-42f2-9216-a8693e94ea84'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'function': {'arguments': '{}', 'name': 'transfer_to_gsearchagent'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 14, 'prompt_tokens': 1011, 'total_tokens': 1025, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_523b9b6e5f', 'finish_reason': 'tool_calls', 'logprobs': None}, name='supervisor', id='run-0b75c81a-cad3-424f-afd1-a407860c62f1-0', tool_calls=[{'name': 'transfer_to_gsearchagent', 'args': {}, 'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1011, 'output_tokens': 14, 'total_tokens': 1025, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), ToolMessage(content='Successfully transferred to GSearchAgent', name='transfer_to_gsearchagent', id='444b7002-2f15-4c02-89a2-93ece54df238', tool_call_id='call_YMbF7OkWWH2AFQb5VedTKBY7'), AIMessage(content='The 10th President of the United States was John Tyler. He served from 1841 to 1845.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 96, 'total_tokens': 122, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_ff092ab25e', 'finish_reason': 'stop', 'logprobs': None}, name='GSearchAgent', id='run-643d10b3-2a23-4c6e-9d63-751e62685f53-0', usage_metadata={'input_tokens': 96, 'output_tokens': 26, 'total_tokens': 122, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), AIMessage(content='Transferring back to supervisor', additional_kwargs={}, response_metadata={}, name='GSearchAgent', id='2e842837-2dfb-42a4-a968-a1cab66533df', tool_calls=[{'name': 'transfer_back_to_supervisor', 'args': {}, 'id': 'a1780a61-b190-4b29-8b7b-ea7b4ec494c1', 'type': 'tool_call'}]), ToolMessage(content='Successfully transferred back to supervisor', name='transfer_back_to_supervisor', id='2ecaee32-8cfd-460f-9a12-74d069214010', tool_call_id='a1780a61-b190-4b29-8b7b-ea7b4ec494c1'), AIMessage(content='The 10th President of the United States was John Tyler, who served from 1841 to 1845.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 1120, 'total_tokens': 1146, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_523b9b6e5f', 'finish_reason': 'stop', 'logprobs': None}, name='supervisor', id='run-43497ffa-1c02-41e1-a8a7-6972bef70e35-0', usage_metadata={'input_tokens': 1120, 'output_tokens': 26, 'total_tokens': 1146, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}),)),



 StateSnapshot(values={'messages': [HumanMessage(content='Who was the 10th US president?', additional_kwargs={}, response_metadata={}, id='b1a585f0-866d-42f2-9216-a8693e94ea84'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'function': {'arguments': '{}', 'name': 'transfer_to_gsearchagent'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 14, 'prompt_tokens': 1011, 'total_tokens': 1025, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_523b9b6e5f', 'finish_reason': 'tool_calls', 'logprobs': None}, name='supervisor', id='run-0b75c81a-cad3-424f-afd1-a407860c62f1-0', tool_calls=[{'name': 'transfer_to_gsearchagent', 'args': {}, 'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1011, 'output_tokens': 14, 'total_tokens': 1025, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), ToolMessage(content='Successfully transferred to GSearchAgent', name='transfer_to_gsearchagent', id='444b7002-2f15-4c02-89a2-93ece54df238', tool_call_id='call_YMbF7OkWWH2AFQb5VedTKBY7')]}, next=('GSearchAgent',), config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1efec06f-88a7-633e-8001-375fa4b6d39d'}}, metadata={'source': 'loop', 'writes': {'supervisor': [{'messages': [HumanMessage(content='Who was the 10th US president?', additional_kwargs={}, response_metadata={}, id='b1a585f0-866d-42f2-9216-a8693e94ea84'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'function': {'arguments': '{}', 'name': 'transfer_to_gsearchagent'}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 14, 'prompt_tokens': 1011, 'total_tokens': 1025, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_523b9b6e5f', 'finish_reason': 'tool_calls', 'logprobs': None}, name='supervisor', id='run-0b75c81a-cad3-424f-afd1-a407860c62f1-0', tool_calls=[{'name': 'transfer_to_gsearchagent', 'args': {}, 'id': 'call_YMbF7OkWWH2AFQb5VedTKBY7', 'type': 'tool_call'}], usage_metadata={'input_tokens': 1011, 'output_tokens': 14, 'total_tokens': 1025, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}, {'messages': [ToolMessage(content='Successfully transferred to GSearchAgent', name='transfer_to_gsearchagent', id='444b7002-2f15-4c02-89a2-93ece54df238', tool_call_id='call_YMbF7OkWWH2AFQb5VedTKBY7')]}]}, 'thread_id': '1', 'step': 1, 'parents': {}}, created_at='2025-02-16T01:40:15.555652+00:00', parent_config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1efec06f-8379-6e2a-8000-a4c6f713eed3'}}, tasks=(PregelTask(id='89068b61-2077-b6b2-c61e-c734b96594d6', name='GSearchAgent', path=('__pregel_pull', 'GSearchAgent'), error=None, interrupts=(), state={'configurable': {'thread_id': '1', 'checkpoint_ns': 'GSearchAgent:89068b61-2077-b6b2-c61e-c734b96594d6'}}, result={'messages': [AIMessage(content='The 10th President of the United States was John Tyler. He served from 1841 to 1845.', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 96, 'total_tokens': 122, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-4o-2024-08-06', 'system_fingerprint': 'fp_ff092ab25e', 'finish_reason': 'stop', 'logprobs': None}, name='GSearchAgent', id='run-643d10b3-2a23-4c6e-9d63-751e62685f53-0', usage_metadata={'input_tokens': 96, 'output_tokens': 26, 'total_tokens': 122, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), AIMessage(content='Transferring back to supervisor', additional_kwargs={}, response_metadata={}, name='GSearchAgent', tool_calls=[{'name': 'transfer_back_to_supervisor', 'args': {}, 'id': 'a1780a61-b190-4b29-8b7b-ea7b4ec494c1', 'type': 'tool_call'}]), ToolMessage(content='Successfully transferred back to supervisor', name='transfer_back_to_supervisor', tool_call_id='a1780a61-b190-4b29-8b7b-ea7b4ec494c1')]}),)),

 StateSnapshot(values={'messages': [HumanMessage(content='Who was the 10th US president?', additional_kwargs={}, response_metadata={}, id='b1a585f0-866d-42f2-9216-a8693e94ea84')]}, next=('supervisor',), config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1efec06f-8379-6e2a-8000-a4c6f713eed3'}}, metadata={'source': 'loop', 'writes': None, 'thread_id': '1', 'step': 0, 'parents': {}}, created_at='2025-02-16T01:40:15.012811+00:00', parent_config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1efec06f-8377-6738-bfff-c6a96fbbb30f'}}, tasks=(PregelTask(id='caf8ab33-4cfb-a67b-b5a1-e5f651b25194', name='supervisor', path=('__pregel_pull', 'supervisor'), error=None, interrupts=(), state={'configurable': {'thread_id': '1', 'checkpoint_ns': 'supervisor:caf8ab33-4cfb-a67b-b5a1-e5f651b25194'}}, result={'messages': [ToolMessage(content='Successfully transferred to GSearchAgent', name='transfer_to_gsearchagent', tool_call_id='call_YMbF7OkWWH2AFQb5VedTKBY7')]}),)),
 
StateSnapshot(values={'messages': []}, next=('__start__',), config={'configurable': {'thread_id': '1', 'checkpoint_ns': '', 'checkpoint_id': '1efec06f-8377-6738-bfff-c6a96fbbb30f'}}, metadata={'source': 'input', 'writes': {'__start__': {'messages': [['user', 'Who was the 10th US president?']]}}, 'thread_id': '1', 'step': -1, 'parents': {}}, created_at='2025-02-16T01:40:15.011816+00:00', parent_config=None, tasks=(PregelTask(id='c35e8fd3-34e7-d932-9ac2-771a2afc3a2a', name='__start__', path=('__pregel_pull', '__start__'), error=None, interrupts=(), state=None, result={'messages': [['user', 'Who was the 10th US president?']]}),))]


"""

# Parse the snapshots:
parsed_snapshots = parse_all_snapshots(input_string)
